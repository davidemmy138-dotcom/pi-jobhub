<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pi Payment App</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>ðŸ’¸ Pay with Pi</h1>
  <button id="payButton">Pay 1 Pi</button>
  <div id="status">Status: Ready</div>

  <script>
    document.getElementById("payButton").onclick = async () => {
      const paymentData = {
        amount: 1,
        memo: "Test payment"
      };

      const callbacks = {
        onReadyForServerApproval: async (paymentId) => {
          console.log("Approving:", paymentId);
          fetch("/approve", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ paymentId })
          }).then(r => r.json()).then(d => console.log("Approved:", d));
        },
        onReadyForServerCompletion: async (paymentId, txid) => {
          console.log("Completing:", txid);
          fetch("/complete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ paymentId, txid })
          }).then(r => r.json()).then(d => console.log("Completed:", d));
        },
        onCancel: () => { alert("Payment canceled"); },
        onError: (err) => { alert("Error: " + err); }
      };

      await window.Pi.createPayment(paymentData, callbacks);
    };
  </script>
</body>
</html>
